// Test: single spawned thread with loop adding to shared variable
// Expected: 10

shared counter: int = 0;

fn worker() {
  let i: int = 0;
  while i < 10 {
    atomic.add(counter, 1);
    i = i + 1;
  }
}

fn main() -> int {
  let t: thread = spawn worker();
  join t;
  return atomic.load(counter);
}
